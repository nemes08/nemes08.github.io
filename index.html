<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ayasofya VakfÄ± â€” BaÄŸÄ±ÅŸ (Siyah &amp; AltÄ±n)</title>

<!-- Pi SDK (yÃ¼klenir; Pi Browser iÃ§inde kullanÄ±lacak) -->
<script src="https://sdk.minepi.com/pi-sdk.js"></script>

<!-- Minimal meta for theme color -->
<meta name="theme-color" content="#0b0b0b">

<style>
  /* ---------- Root / Vars ---------- */
  :root{
    --bg: #0b0b0b;
    --panel: #0f0f0f;
    --muted: #bfb7a3;
    --gold: #D4AF37;
    --accent: linear-gradient(135deg,#bb8b00,#ffd873);
    --glass: rgba(255,255,255,0.03);
    --glass-2: rgba(255,255,255,0.02);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(212,175,55,0.03), transparent),
                linear-gradient(180deg, #070707 0%, #0b0b0b 100%);
    color:#efeae0;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:28px 16px;
  }

  /* ---------- Container ---------- */
  .wrap{
    width:100%;
    max-width:980px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px;
    box-shadow: 0 12px 60px rgba(0,0,0,0.7);
    padding:26px;
    border:1px solid rgba(212,175,55,0.06);
    position:relative;
    overflow:hidden;
  }

  /* soft filigran (centered, subtle) */
  .wrap::after{
    content:'';
    position:absolute;
    inset:0;
    background-image: url('images/ayasofya-hero.svg');
    background-position:center top;
    background-repeat:no-repeat;
    background-size: 72%;
    opacity:0.03;
    pointer-events:none;
    filter: blur(1px);
  }

  header{
    text-align:center;
    position:relative;
    z-index:2;
  }

  .logo{
    width:120px;
    height:auto;
    display:block;
    margin:0 auto 8px;
    filter: drop-shadow(0 8px 20px rgba(0,0,0,0.6));
  }

  .heart{
    display:inline-block;
    font-size:28px;
    color:var(--gold);
    margin-bottom:6px;
    animation: beat 1.4s infinite;
  }
  @keyframes beat{
    0%, 60%, 100%{ transform: scale(1); }
    30%{ transform: scale(1.18); }
  }

  h1{ margin:6px 0 4px; font-size:24px; letter-spacing:0.6px; color:#fff; }
  .lead{ color:var(--muted); margin:0 0 12px; }

  /* language + status row */
  .top-row{
    display:flex;
    gap:10px;
    align-items:center;
    justify-content:center;
    margin-top:10px;
    flex-wrap:wrap;
  }
  .lang-btn{
    background:transparent;
    color:var(--muted);
    border:1px solid rgba(255,255,255,0.03);
    padding:6px 10px;
    border-radius:8px;
    cursor:pointer;
    font-weight:700;
  }
  .lang-btn.active{ color:#0b0b0b; background:var(--gold); border-color:rgba(212,175,55,0.2) }

  .pi-status{
    margin-left:6px;
    color:var(--muted);
    font-weight:700;
    background:linear-gradient(90deg, rgba(212,175,55,0.06), transparent);
    padding:8px 12px;
    border-radius:10px;
    border:1px solid rgba(212,175,55,0.04);
    display:flex;
    gap:8px;
    align-items:center;
  }

  /* ---------- Donation area ---------- */
  .donation{
    margin-top:20px;
    display:flex;
    gap:18px;
    align-items:flex-start;
    justify-content:space-between;
    flex-wrap:wrap;
    position:relative;
    z-index:2;
  }

  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    border-radius:12px;
    padding:18px;
    width:100%;
    max-width:560px;
    border:1px solid rgba(255,255,255,0.02);
    box-shadow:0 10px 30px rgba(0,0,0,0.5);
  }

  .panel h2{ margin:0 0 6px; color:var(--gold); font-size:20px; }
  .panel p{ color:var(--muted); margin:0 0 12px; }

  .amounts{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom:10px;
  }

  /* ---------- Gold 3D buttons ---------- */
  .btn-gold{
    --g1:#e0b74a;
    --g2:#b5810c;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    padding:12px 18px;
    border-radius:12px;
    border:0;
    cursor:pointer;
    color:#1b1200;
    font-weight:800;
    font-size:16px;
    background: linear-gradient(180deg,var(--g1),var(--g2));
    box-shadow: 0 8px 24px rgba(181,129,12,0.18), inset 0 -4px 10px rgba(0,0,0,0.08);
    transform: translateY(0);
    transition: transform .16s ease, box-shadow .16s ease;
    min-width:96px;
  }
  .btn-gold:hover{ transform: translateY(-6px); box-shadow: 0 18px 40px rgba(181,129,12,0.22); }
  .btn-gold:active{ transform: translateY(-2px); }

  .btn-outline{
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    color:var(--muted);
    padding:10px 14px;
    border-radius:10px;
    cursor:pointer;
  }

  /* ---------- QR card ---------- */
  .qr-card{
    width:240px;
    border-radius:12px;
    padding:14px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow:0 14px 36px rgba(0,0,0,0.5);
    text-align:center;
    border:1px solid rgba(255,255,255,0.02);
  }
  .qr-card img{ width:180px; height:180px; border-radius:12px; display:block; margin:0 auto 8px; }
  .qr-card small{ color:var(--muted); display:block; margin-top:8px; }

  /* ---------- Stats ---------- */
  .stats{
    display:flex;
    gap:8px;
    margin-top:12px;
    justify-content:center;
    flex-wrap:wrap;
  }
  .stat{
    background:var(--glass);
    padding:8px 12px;
    border-radius:8px;
    color:var(--muted);
    font-weight:700;
  }

  /* ---------- Receipt (popup) ---------- */
  .receipt{
    position:fixed;
    right:18px;
    bottom:18px;
    z-index:9;
    background:#0f0f0f;
    color:#efeae0;
    padding:14px;
    border-radius:12px;
    box-shadow: 0 18px 60px rgba(0,0,0,0.6);
    border:1px solid rgba(212,175,55,0.06);
    display:none;
    min-width:260px;
  }
  .receipt .close{ float:right; cursor:pointer; font-weight:700; color:var(--muted) }

  /* ---------- Footer ---------- */
  footer{
    margin-top:18px;
    padding-top:14px;
    border-top: 1px solid rgba(255,255,255,0.02);
    color:var(--muted);
    text-align:center;
    font-size:13px;
  }
  footer a{ color:var(--gold); text-decoration:none; font-weight:700; }

  /* Responsive */
  @media (max-width:820px){
    .donation{ flex-direction:column; gap:14px; align-items:center; }
    .qr-card{ width:220px }
    .panel{ max-width:100% }
  }
</style>
</head>
<body>
  <div class="wrap" role="main">

    <header>
      <img src="images/logo.png" alt="Ayasofya VakfÄ± Logosu" class="logo" />
      <div class="heart" aria-hidden="true">ğŸ’œ</div>
      <h1>Ayasofya VakfÄ±</h1>
      <p class="lead">Ä°htiyaÃ§ sahiplerine destek â€” Pi Network ile ÅŸeffaf baÄŸÄ±ÅŸ</p>

      <div class="top-row" role="region" aria-label="Dil ve durum">
        <div>
          <button class="lang-btn active" id="lang-tr">TR</button>
          <button class="lang-btn" id="lang-en">EN</button>
        </div>

        <div id="piStatus" class="pi-status" aria-live="polite">
          <span id="piIcon">ğŸ”„</span>
          <span id="piText">Pi baÄŸlantÄ±sÄ± kontrol ediliyor...</span>
        </div>
      </div>
    </header>

    <section class="donation" aria-labelledby="donateHeading">
      <div class="panel" aria-hidden="false">
        <h2 id="donateHeading">BaÄŸÄ±ÅŸ Yap</h2>
        <p id="donateDesc">Bir miktar seÃ§in veya Ã¶zel miktar girin.</p>

        <div class="amounts" role="list">
          <button class="btn-gold donate" data-amount="1">1 Ï€</button>
          <button class="btn-gold donate" data-amount="5">5 Ï€</button>
          <button class="btn-gold donate" data-amount="10">10 Ï€</button>
          <button class="btn-outline" id="customBtn">Ã–zel Miktar</button>
        </div>

        <div class="stats" aria-hidden="false">
          <div class="stat">Toplam: <span id="statTotal">0 Ï€</span></div>
          <div class="stat">BaÄŸÄ±ÅŸÃ§Ä±: <span id="statDonors">0</span></div>
        </div>

        <div style="margin-top:12px; text-align:center;">
          <button class="btn-outline" id="donateWithQR">QR ile BaÄŸÄ±ÅŸ Yap</button>
        </div>
      </div>

      <aside class="qr-card" aria-label="QR kod">
        <img id="qrImg" alt="QR Kod" src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=Ayasofya%20Vakfi" />
        <small id="qrNote">QR ile okutun veya butona basÄ±n</small>
      </aside>
    </section>

    <div id="receipt" class="receipt" role="alert" aria-live="assertive"></div>

    <div style="text-align:center; margin-top:18px; z-index:2;">
      <nav class="social" aria-label="Sosyal medya">
        <a href="https://tiktok.com/@semenuur" target="_blank" rel="noopener noreferrer">ğŸµ TikTok</a>
        <a href="https://instagram.com/uursemen08" target="_blank" rel="noopener noreferrer">ğŸ“¸ Instagram</a>
        <a href="https://youtube.com/@uursemen08" target="_blank" rel="noopener noreferrer">â–¶ï¸ YouTube</a>
        <a href="https://x.com/uursemen2" target="_blank" rel="noopener noreferrer">ğŸ¦ X</a>
      </nav>
    </div>

    <footer>
      Â© 2025 Ayasofya VakfÄ± | TÃ¼m haklarÄ± saklÄ±dÄ±r
      <div style="margin-top:6px;">
        <a href="privacy.html">Gizlilik PolitikasÄ±</a> |
        <a href="kvkk.html">KVKK</a> |
        <a href="terms.html">KullanÄ±m ÅartlarÄ±</a>
      </div>
    </footer>
  </div>

<script>
/* ---------- Helpers ---------- */
const $ = id => document.getElementById(id);
const elAll = sel => Array.from(document.querySelectorAll(sel));

/* ---------- Local stats (persistent) ---------- */
let total = parseFloat(localStorage.getItem('ay_total') || '0');
let donors = parseInt(localStorage.getItem('ay_donors') || '0');
function renderStats(){
  $('statTotal').innerText = `${total} Ï€`;
  $('statDonors').innerText = `${donors}`;
}
renderStats();

/* ---------- Language ---------- */
function setLang(l){
  if(l==='en'){
    $('donateHeading').innerText = 'Make a Donation';
    $('donateDesc').innerText = 'Choose an amount or enter custom amount.';
    $('donateWithQR').innerText = 'Donate with QR';
    $('piText').innerText = 'Pi connection checking...';
    elAll('.donate').forEach(b=>{
      const a=b.getAttribute('data-amount');
      if(a) b.innerText = `${a} Ï€`;
    });
  } else {
    $('donateHeading').innerText = 'BaÄŸÄ±ÅŸ Yap';
    $('donateDesc').innerText = 'Bir miktar seÃ§in veya Ã¶zel miktar girin.';
    $('donateWithQR').innerText = 'QR ile BaÄŸÄ±ÅŸ Yap';
    $('piText').innerText = 'Pi baÄŸlantÄ±sÄ± kontrol ediliyor...';
    elAll('.donate').forEach(b=>{
      const a=b.getAttribute('data-amount');
      if(a) b.innerText = `${a} Ï€`;
    });
  }
}
document.getElementById('lang-tr').addEventListener('click', ()=>{ setLang('tr'); document.getElementById('lang-tr').classList.add('active'); document.getElementById('lang-en').classList.remove('active');});
document.getElementById('lang-en').addEventListener('click', ()=>{ setLang('en'); document.getElementById('lang-en').classList.add('active'); document.getElementById('lang-tr').classList.remove('active');});

/* ---------- Pi detection & auth ---------- */
let PI_AVAILABLE = false;
async function detectPi(){
  try{
    if(window.Pi && typeof window.Pi.createPayment === 'function'){
      PI_AVAILABLE = true;
      // attempt to authenticate (non-blocking)
      try{
        const user = await window.Pi.authenticate(['username']);
        $('piIcon').innerText = 'âœ”';
        $('piText').innerText = user && user.user && user.user.username ? `âœ” Pi baÄŸlantÄ±sÄ± doÄŸrulandÄ±: @${user.user.username}` : 'âœ” Pi baÄŸlantÄ±sÄ± doÄŸrulandÄ±';
      }catch(e){
        $('piIcon').innerText = 'âš ';
        $('piText').innerText = 'Pi Browser iÃ§inden tam deneyim (oturum gerekebilir).';
      }
    } else {
      PI_AVAILABLE = false;
      $('piIcon').innerText = 'ğŸ”Œ';
      $('piText').innerText = 'Pi SDK bulunamadÄ± â€” Pi Browser\'da aÃ§Ä±nÄ±z.';
    }
  }catch(err){
    PI_AVAILABLE = false;
    $('piIcon').innerText = 'âš ';
    $('piText').innerText = 'Pi baÄŸlantÄ±sÄ± kontrol edilemedi.';
  }
}
window.addEventListener('load', ()=>{ detectPi(); });

/* ---------- QR helpers ---------- */
function setPersistentQR(payload){
  const url = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(payload)}`;
  $('qrImg').src = url;
}

/* ---------- Donation flow ---------- */
async function finalizeDonation(amount, txId){
  // update stats
  total = Math.round((total + Number(amount)) * 100) / 100;
  donors = donors + 1;
  localStorage.setItem('ay_total', total);
  localStorage.setItem('ay_donors', donors);
  renderStats();

  // Prepare receipt content
  const date = new Date().toLocaleString();
  const payload = JSON.stringify({project:'Ayasofya VakfÄ±', amount, tx: txId, date:new Date().toISOString()});
  setPersistentQR(payload);

  const r = $('receipt');
  r.innerHTML = `<div style="font-weight:800; margin-bottom:6px">${(document.getElementById('lang-en')?.classList.contains('active')) ? 'Thank you!' : 'TeÅŸekkÃ¼rler!'}</div>
                 <div>${amount} Ï€</div>
                 <div style="color:var(--muted); margin-top:6px; font-size:13px">${date}</div>
                 <div style="color:var(--muted); margin-top:6px; font-size:13px">Tx: ${txId}</div>
                 <div style="margin-top:8px; text-align:center;"><img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(payload)}" alt="QR"></div>
                 <div style="text-align:right; margin-top:6px"><button class="btn-outline" id="closeReceipt">Kapat</button></div>`;
  r.style.display = 'block';
  $('closeReceipt').addEventListener('click', ()=> r.style.display='none');
}

/* startPayment: uses Pi SDK if available; otherwise uses demo fallback */
async function startPayment(amount){
  if(!amount || isNaN(amount)){ alert('GeÃ§erli miktar girin'); return; }

  if(PI_AVAILABLE){
    try{
      // createPayment with Pi Browser SDK
      window.Pi.createPayment({
        amount: Number(amount),
        memo: "Ayasofya VakfÄ± â€” Donation",
        metadata: {type:'donation'}
      },{
        onReadyForServerApproval(paymentId){
          console.log('approval requested:', paymentId);
        },
        onReadyForServerCompletion(paymentId){
          console.log('completed', paymentId);
          finalizeDonation(amount, paymentId || ('pi-' + Date.now()));
        },
        onCancel(){
          alert('BaÄŸÄ±ÅŸ iptal edildi.');
        },
        onError(err){
          console.error('Pi error', err);
          alert('Ã–deme sÄ±rasÄ±nda hata: ' + (err && err.message ? err.message : JSON.stringify(err)));
        }
      });
    }catch(e){
      console.error('createPayment failed', e);
      alert('Ã–deme baÅŸlatÄ±lamadÄ±. LÃ¼tfen Pi Browser ile deneyiniz.');
    }
  } else {
    // demo fallback â€” simulate success
    const fakeTx = 'demo-' + Date.now();
    setTimeout(()=> finalizeDonation(amount, fakeTx), 900);
  }
}

/* ---------- UI wiring ---------- */
elAll('.donate').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    const amount = btn.getAttribute('data-amount');
    startPayment(amount);
  });
});

$('customBtn').addEventListener('click', ()=>{
  const input = prompt('LÃ¼tfen baÄŸÄ±ÅŸ miktarÄ±nÄ± girin (Pi)', '1');
  if(!input) return;
  const v = parseFloat(input);
  if(isNaN(v) || v <= 0) return alert('GeÃ§erli bir miktar girin.');
  startPayment(v);
});

$('donateWithQR').addEventListener('click', ()=>{
  // open a modal? for now show alert hint
  alert('QR ile baÄŸÄ±ÅŸ: QR kodu okutun. Ã–deme baÅŸlatmak iÃ§in butona basÄ±n veya Pi Browser iÃ§inde QR okutun.');
});

/* close receipt on Esc */
window.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape') $('receipt').style.display='none';
});

/* click outside receipt hides it */
document.addEventListener('click', (e)=>{
  const r = $('receipt');
  if(r.style.display==='block' && !r.contains(e.target)) r.style.display='none';
});

/* expose for console testing (optional) */
window.AY = { startPayment, finalizeDonation, setPersistentQR, getStats: ()=>({total,donors}) };

</script>
</body>
</html>
