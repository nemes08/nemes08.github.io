<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ayasofya VakfÄ± â€” BaÄŸÄ±ÅŸ</title>

<!-- Pi SDK (yalnÄ±zca Pi Browser iÃ§inde aktif olur) -->
<script src="https://sdk.minepi.com/pi-sdk.js"></script>

<style>
  :root{
    --bg:#faf7f2;
    --muted:#666;
    --primary:#7b4bff;
    --gold:#d6b35a;
    --card:#ffffff;
  }
  *{box-sizing:border-box}
  body{
    font-family: "Segoe UI", system-ui, -apple-system, Arial, sans-serif;
    margin:0; padding:0;
    text-align:center;
    color:#222;
    background:var(--bg);
    -webkit-font-smoothing:antialiased;
    min-height:100vh;
    position:relative;
  }

  /* Filigran (arka plan) - varsa images/ayasofya-bg.png koy */
  body::before{
    content:"";
    position:fixed;
    inset:0;
    background-image: url('images/ayasofya-bg.png');
    background-repeat:no-repeat;
    background-position: center top;
    background-size: cover;
    opacity:0.06;
    filter: blur(2px);
    pointer-events:none;
    z-index:0;
  }

  header{ padding:20px 14px; position:relative; z-index:2; }
  .logo{ width:160px; height:auto; display:block; margin:0 auto 8px; animation:pulse 2s infinite; }
  @keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.06)}}
  .heart{ font-size:30px; color:var(--primary); margin-top:6px; animation:beat 1.3s infinite; }
  @keyframes beat{0%,40%,80%,100%{transform:scale(1);}20%,60%{transform:scale(1.25)}}
  h1{ font-size:26px; margin:10px 0; }
  .lead{ color:var(--muted); margin:6px 0 10px; }

  .lang-box{ margin-top:10px; display:inline-flex; gap:8px; z-index:2; }
  .lang-btn{ background:#eee; border:0; padding:6px 10px; border-radius:8px; cursor:pointer; font-weight:700; }

  .valid-box{
    display:none;
    margin:14px auto;
    max-width:880px;
    background: linear-gradient(90deg, rgba(214,179,90,0.08), rgba(214,179,90,0.03));
    color:#6a4c12;
    padding:10px 14px;
    border-radius:10px;
    border:1px solid rgba(214,179,90,0.08);
    font-weight:700;
    z-index:2;
    position:relative;
  }

  main{ padding:12px; z-index:2; position:relative; }
  .donation-section{ margin:18px auto; max-width:920px; }
  .btn-row{ display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:10px; }
  .btn {
    background:var(--primary); color:#fff; border:none; border-radius:8px; padding:10px 16px;
    cursor:pointer; font-weight:700; box-shadow:0 8px 22px rgba(123,75,255,0.12);
    transition:transform .16s, box-shadow .16s;
  }
  .btn:hover{ transform:translateY(-4px); box-shadow:0 18px 36px rgba(123,75,255,0.14); }

  /* Persistent QR card */
  .qr-card{
    display:inline-block; margin-top:18px; padding:10px; border-radius:12px; background:var(--card);
    box-shadow:0 14px 36px rgba(0,0,0,0.08); transition:transform .22s, box-shadow .22s; cursor:pointer;
    z-index:2;
  }
  .qr-card:hover{ transform:scale(1.04); box-shadow:0 22px 50px rgba(0,0,0,0.14); }
  .qr-card img{ width:140px; height:140px; border-radius:12px; display:block; }

  /* Receipt popup */
  .receipt{
    position:fixed; right:16px; bottom:16px; background:#fff; color:#111; padding:14px 16px;
    border-radius:12px; box-shadow:0 18px 50px rgba(0,0,0,0.16); display:none; z-index:5; max-width:340px; text-align:left;
  }
  .receipt .close{ float:right; cursor:pointer; color:#666; font-weight:700; margin-left:6px; }

  .stats{ margin-top:12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap; z-index:2; }
  .stat{ background:rgba(255,255,255,0.9); padding:8px 12px; border-radius:10px; box-shadow:0 8px 20px rgba(0,0,0,0.04); color:#111; font-weight:700; }

  .socials{ margin-top:14px; z-index:2; position:relative; }
  .socials a{ margin:0 6px; text-decoration:none; display:inline-block; font-size:22px; transition:transform .16s; }
  .socials a:hover{ transform:translateY(-4px); }

  footer{ margin:30px 0 60px; color:var(--muted); z-index:2; position:relative; font-size:14px; }
  footer a{ color:var(--muted); text-decoration:underline; margin:0 6px; cursor:pointer; }

  /* Modal */
  .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.5); z-index:8; padding:18px; }
  .panel{ background:#fff; width:100%; max-width:880px; border-radius:12px; padding:18px; text-align:left; max-height:80vh; overflow:auto; }
  .panel .close{ float:right; cursor:pointer; font-weight:700; }

  @media (max-width:720px){
    .logo{ width:130px; }
    .qr-card img{ width:110px; height:110px; }
    .receipt{ left:10px; right:10px; }
  }
</style>
</head>
<body>

  <!-- Header -->
  <header>
    <img src="images/logo.png" class="logo" alt="Ayasofya VakfÄ± Logosu">
    <div class="heart" aria-hidden="true">ğŸ’œ</div>

    <h1 id="site-title">Ayasofya VakfÄ±</h1>
    <p class="lead" id="site-sub">Ä°htiyaÃ§ sahiplerine destek â€” Pi Network Ã¼zerinden ÅŸeffaf baÄŸÄ±ÅŸ</p>

    <div class="lang-box" role="tablist" aria-label="Dil">
      <button class="lang-btn" id="lang-tr" onclick="setLang('tr')">ğŸ‡¹ğŸ‡· TR</button>
      <button class="lang-btn" id="lang-en" onclick="setLang('en')">ğŸ‡¬ğŸ‡§ EN</button>
    </div>
  </header>

  <!-- Valide banner -->
  <div class="valid-box" id="validBox" role="status" aria-live="polite">âœ” Pi baÄŸlantÄ±sÄ± doÄŸrulanÄ±yor...</div>

  <!-- Main donation area -->
  <main>
    <section class="donation-section" aria-labelledby="donate-heading">
      <h2 id="donate-heading">BaÄŸÄ±ÅŸ Yap</h2>
      <p id="donate-desc">Miktar seÃ§in:</p>

      <div class="btn-row" aria-hidden="false">
        <button class="btn" data-amount="1" onclick="onAmount(1)">1 Pi</button>
        <button class="btn" data-amount="5" onclick="onAmount(5)">5 Pi</button>
        <button class="btn" data-amount="10" onclick="onAmount(10)">10 Pi</button>
        <button class="btn" onclick="onCustom()">BaÄŸÄ±ÅŸÄ± GÃ¶nder</button>
      </div>

      <!-- persistent QR card -->
      <div id="persistentQR" style="margin-top:18px;">
        <div class="qr-card" id="qrCard" title="QR ile baÄŸÄ±ÅŸ yap (tÄ±klayÄ±nÄ±z)">
          <img id="qrPersistentImg" alt="QR Kod" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=Ayasofya%20Vakfi" />
        </div>
      </div>

      <div class="stats" aria-hidden="false">
        <div class="stat"><small>Toplam</small><div id="stat-total">0 Ï€</div></div>
        <div class="stat"><small>BaÄŸÄ±ÅŸÃ§Ä±</small><div id="stat-donors">0</div></div>
      </div>
    </section>
  </main>

  <!-- Receipt (popup) -->
  <div class="receipt" id="receipt" role="alert" aria-live="assertive"></div>

  <!-- Socials -->
  <div class="socials" aria-label="Sosyal medya">
    <a href="https://tiktok.com/@semenuur" target="_blank" rel="noopener noreferrer" title="TikTok">ğŸµ</a>
    <a href="https://instagram.com/uursemen08" target="_blank" rel="noopener noreferrer" title="Instagram">ğŸ“¸</a>
    <a href="https://youtube.com/@uursemen08" target="_blank" rel="noopener noreferrer" title="YouTube">â–¶ï¸</a>
    <a href="https://x.com/uursemen2" target="_blank" rel="noopener noreferrer" title="X">ğŸ¦</a>
  </div>

  <!-- Footer -->
  <footer>
    Â© 2025 Ayasofya VakfÄ± | TÃ¼m haklarÄ± saklÄ±dÄ±r
    <br>
    <a id="link-privacy">Gizlilik PolitikasÄ±</a> |
    <a id="link-kvkk">KVKK</a> |
    <a id="link-terms">KullanÄ±m ÅartlarÄ±</a>
  </footer>

  <!-- Modals -->
  <div class="modal" id="modal-privacy"><div class="panel"><span class="close" onclick="closeModal('modal-privacy')">âœ•</span><h3>Gizlilik PolitikasÄ±</h3><p>Bu platform baÄŸÄ±ÅŸ iÅŸlemleri, iletiÅŸim ve istatistik amaÃ§lÄ± sÄ±nÄ±rlÄ± veri toplar. KiÅŸisel veriler yasal gereklilikler haricinde paylaÅŸÄ±lmaz. Detay iÃ§in vakÄ±f ile iletiÅŸime geÃ§in.</p></div></div>
  <div class="modal" id="modal-kvkk"><div class="panel"><span class="close" onclick="closeModal('modal-kvkk')">âœ•</span><h3>KVKK AydÄ±nlatma Metni</h3><p>KiÅŸisel veriler baÄŸÄ±ÅŸ iÅŸlemlerinin yÃ¼rÃ¼tÃ¼lmesi, muhasebe ve yasal yÃ¼kÃ¼mlÃ¼lÃ¼klerin yerine getirilmesi amacÄ±yla iÅŸlenir.</p></div></div>
  <div class="modal" id="modal-terms"><div class="panel"><span class="close" onclick="closeModal('modal-terms')">âœ•</span><h3>KullanÄ±m ÅartlarÄ±</h3><p>Site Ã¼zerinden yapÄ±lan baÄŸÄ±ÅŸlar gÃ¶nÃ¼llÃ¼dÃ¼r. BaÄŸÄ±ÅŸlarÄ±n kullanÄ±mÄ± vakfÄ±n baÄŸÄ±ÅŸ politikalarÄ±na gÃ¶re yapÄ±lÄ±r.</p></div></div>

<script>
/* Helpers */
const $ = id => document.getElementById(id);
let selectedAmount = null;
let total = parseFloat(localStorage.getItem('ay_total') || '0');
let donors = parseInt(localStorage.getItem('ay_donors') || '0');
const LANG_DEFAULT = (navigator.language && navigator.language.startsWith('en')) ? 'en' : 'tr';
let LANG = LANG_DEFAULT;

/* Language */
function setLang(l){
  LANG = l;
  if(l === 'en'){
    $('site-title').innerText = "Hagia Sophia Foundation";
    $('site-sub').innerText = "Support those in need â€” transparent donations with Pi Network";
    $('donate-heading').innerText = "Make a Donation";
    $('donate-desc').innerText = "Choose an amount:";
  } else {
    $('site-title').innerText = "Ayasofya VakfÄ±";
    $('site-sub').innerText = "Ä°htiyaÃ§ sahiplerine destek â€” Pi Network Ã¼zerinden ÅŸeffaf baÄŸÄ±ÅŸ";
    $('donate-heading').innerText = "BaÄŸÄ±ÅŸ Yap";
    $('donate-desc').innerText = "Miktar seÃ§in:";
  }
}
setLang(LANG);

/* Modal controls */
function openModal(id){ const m=$(id); if(!m) return; m.style.display='flex'; }
function closeModal(id){ const m=$(id); if(!m) return; m.style.display='none'; }
$('link-privacy').addEventListener('click',(e)=>{ e.preventDefault(); openModal('modal-privacy');});
$('link-kvkk').addEventListener('click',(e)=>{ e.preventDefault(); openModal('modal-kvkk');});
$('link-terms').addEventListener('click',(e)=>{ e.preventDefault(); openModal('modal-terms');});

/* QR persistent click */
$('qrCard').addEventListener('click', ()=> {
  alert(LANG==='tr' ? "QR ile baÄŸÄ±ÅŸ: QR'Ä± okutun veya tÄ±klayÄ±n. BaÄŸÄ±ÅŸ butonuna basÄ±nca detaylÄ± makbuz hazÄ±rlanÄ±r." : "QR donation: scan or click. A detailed receipt appears after donation.");
});

/* Buttons */
function onAmount(n){
  selectedAmount = n;
  prepareQR(n);
  // auto-start donation flow (optional), here we only prepare â€” let user press custom or re-click to pay
  // We'll start payment immediately for convenience:
  sendDonation(n);
}
function onCustom(){
  const promptText = LANG==='tr' ? "LÃ¼tfen baÄŸÄ±ÅŸ miktarÄ±nÄ± girin (Pi)" : "Enter donation amount (Pi)";
  const amt = prompt(promptText, "1");
  if(!amt) return;
  const v = parseFloat(amt);
  if(isNaN(v) || v <= 0){ alert(LANG==='tr' ? "GeÃ§erli bir miktar girin." : "Enter a valid amount."); return; }
  selectedAmount = v;
  prepareQR(v);
  sendDonation(v);
}

/* QR util (persistent) */
function prepareQR(amount){
  const payload = `Ayasofya VakfÄ± - Donation ${amount} Ï€`;
  $('qrPersistentImg').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(payload)}`;
}

/* Stats render */
function renderStats(){ $('stat-total').innerText = `${total} Ï€`; $('stat-donors').innerText = `${donors}`; }
renderStats();

/* Pi SDK detection and valid box */
let PI_AVAILABLE = false;
function detectPi(){
  try{
    if(window.Pi && typeof window.Pi.createPayment === 'function'){
      PI_AVAILABLE = true;
      // try to read username if exposed
      let username = null;
      try{ if(window.Pi.user && window.Pi.user.username) username = window.Pi.user.username; }catch(e){}
      $('validBox').style.display = 'block';
      $('validBox').innerText = username ? `âœ” Pi baÄŸlantÄ±sÄ± doÄŸrulandÄ±: @${username}` : 'âœ” Pi baÄŸlantÄ±sÄ± doÄŸrulandÄ±';
    } else {
      PI_AVAILABLE = false;
      $('validBox').style.display = 'block';
      $('validBox').innerText = 'ğŸ” Pi Browser iÃ§inde daha iyi deneyim (SDK yok)';
    }
  }catch(e){
    PI_AVAILABLE = false;
    $('validBox').style.display = 'block';
    $('validBox').innerText = 'ğŸ” BaÄŸlantÄ± kontrol edilemedi';
  }
}
window.addEventListener('load', detectPi);

/* Donation flow: use Pi SDK when possible, else demo fallback */
function sendDonation(amount){
  if(!amount){ alert(LANG==='tr' ? 'LÃ¼tfen bir miktar seÃ§in.' : 'Please select an amount.'); return; }

  // disable briefly (UX)
  document.querySelectorAll('.btn').forEach(b=>b.disabled=true);

  if(PI_AVAILABLE){
    try{
      window.Pi.createPayment({
        amount: amount,
        memo: 'Ayasofya VakfÄ± Donation',
        metadata: { type: 'donation', lang: LANG }
      }, {
        onReadyForServerApproval(paymentId){
          console.log('approval', paymentId);
        },
        onReadyForServerCompletion(paymentId){
          finalizeDonation(amount, paymentId);
        },
        onCancel(){
          alert(LANG==='tr' ? 'BaÄŸÄ±ÅŸ iptal edildi.' : 'Donation cancelled.');
          document.querySelectorAll('.btn').forEach(b=>b.disabled=false);
        },
        onError(err){
          console.error(err);
          alert((LANG==='tr' ? 'Hata oluÅŸtu: ' : 'Error: ') + (err && err.message ? err.message : JSON.stringify(err)));
          document.querySelectorAll('.btn').forEach(b=>b.disabled=false);
        }
      });
    }catch(e){
      console.error(e);
      alert(LANG==='tr' ? 'Ã–deme baÅŸlatÄ±lamadÄ±.' : 'Failed to start payment.');
      document.querySelectorAll('.btn').forEach(b=>b.disabled=false);
    }
  } else {
    // demo: simulate success
    setTimeout(()=> {
      const fakeTx = 'demo-' + Date.now();
      finalizeDonation(amount, fakeTx);
    }, 800);
  }
}

/* finalize */
function finalizeDonation(amount, txId){
  // update stats
  total = Math.round((parseFloat(total) + parseFloat(amount)) * 100) / 100;
  donors = parseInt(donors) + 1;
  localStorage.setItem('ay_total', total);
  localStorage.setItem('ay_donors', donors);
  renderStats();

  // show receipt
  const r = $('receipt');
  const date = new Date().toLocaleString(LANG==='tr' ? 'tr-TR' : 'en-US');
  const payload = JSON.stringify({ project:'Ayasofya VakfÄ±', amount, tx: txId, date: new Date().toISOString() });
  r.innerHTML = `<span class="close" id="receiptClose" title="Kapat">âœ•</span>
                 <div style="font-weight:800;margin-bottom:8px">${LANG==='tr' ? 'TeÅŸekkÃ¼rler!' : 'Thank you!'}</div>
                 <div>${amount} Ï€</div>
                 <div style="margin-top:6px;color:#666;font-size:13px">${date}</div>
                 <div style="margin-top:6px;color:#666;font-size:13px">${LANG==='tr' ? 'Ä°ÅŸlem ID:' : 'Tx ID:'} ${txId}</div>
                 <div style="margin-top:10px"><img src="https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(payload)}" alt="QR Kod" style="width:160px;height:160px;border-radius:10px;"></div>`;
  r.style.display = 'block';
  // close handler
  document.getElementById('receiptClose').addEventListener('click', ()=> r.style.display='none');

  // update persistent QR to detailed payload
  $('qrPersistentImg').src = `https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(payload)}`;

  // re-enable buttons after short delay
  setTimeout(()=> document.querySelectorAll('.btn').forEach(b=>b.disabled=false), 600);
}

/* Close modals & esc */
window.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){ ['modal-privacy','modal-kvkk','modal-terms'].forEach(id=>{const m=$(id); if(m) m.style.display='none';}); const r=$('receipt'); if(r) r.style.display='none'; }
});

/* click outside modal closes */
['modal-privacy','modal-kvkk','modal-terms'].forEach(id=>{
  const m=$(id);
  if(m) m.addEventListener('click', (ev)=> { if(ev.target === m) closeModal(id); });
});

/* accessibility: persistent QR click */
$('qrCard').addEventListener('keydown', (e)=>{ if(e.key === 'Enter') alert('QR ile baÄŸÄ±ÅŸ.'); });

/* expose for testing in console */
window.AY = { sendDonation, prepareQR, finalizeDonation, getStats: ()=>({total,donors}) };

</script>
</body>
</html>
